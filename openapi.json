{
  "paths": {
    "/queue": {
      "get": {
        "responses": {
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "summary": "Queue management page.",
        "tags": [
          "queue"
        ]
      }
    },
    "/get_queue": {
      "get": {
        "responses": {
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "summary": "Get the current song queue.",
        "tags": [
          "queue"
        ]
      }
    },
    "/queue/addrandom/{amount}": {
      "get": {
        "responses": {
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "summary": "Add random songs to the queue.",
        "tags": [
          "queue"
        ]
      },
      "parameters": [
        {
          "in": "path",
          "name": "amount",
          "required": true,
          "schema": {
            "type": "integer",
            "minimum": 0
          }
        }
      ]
    },
    "/queue/reorder": {
      "post": {
        "responses": {
          "422": {
            "$ref": "#/components/responses/UNPROCESSABLE_ENTITY"
          },
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "requestBody": {
          "required": true,
          "content": {
            "application/x-www-form-urlencoded": {
              "schema": {
                "$ref": "#/components/schemas/ReorderForm"
              }
            }
          }
        },
        "summary": "Handle drag-and-drop reordering of the queue.",
        "tags": [
          "queue"
        ]
      }
    },
    "/queue/edit": {
      "get": {
        "parameters": [
          {
            "in": "query",
            "name": "action",
            "description": "Queue edit action to perform",
            "schema": {
              "type": "string"
            },
            "required": true
          },
          {
            "in": "query",
            "name": "song",
            "description": "Path to the song file (required unless action is 'clear')",
            "schema": {
              "type": "string"
            },
            "required": false
          }
        ],
        "responses": {
          "422": {
            "$ref": "#/components/responses/UNPROCESSABLE_ENTITY"
          },
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "summary": "Edit queue items (admin only).",
        "tags": [
          "queue"
        ]
      }
    },
    "/enqueue": {
      "get": {
        "parameters": [
          {
            "in": "query",
            "name": "song",
            "description": "Path to the song file",
            "schema": {
              "type": "string"
            },
            "required": true
          },
          {
            "in": "query",
            "name": "user",
            "description": "Name of the user adding the song",
            "schema": {
              "type": "string",
              "default": ""
            },
            "required": false
          }
        ],
        "responses": {
          "422": {
            "$ref": "#/components/responses/UNPROCESSABLE_ENTITY"
          },
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "summary": "Add a song to the queue (used by the file browser).",
        "tags": [
          "queue"
        ]
      },
      "post": {
        "responses": {
          "422": {
            "$ref": "#/components/responses/UNPROCESSABLE_ENTITY"
          },
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "requestBody": {
          "required": true,
          "content": {
            "application/x-www-form-urlencoded": {
              "schema": {
                "$ref": "#/components/schemas/EnqueueForm"
              }
            }
          }
        },
        "summary": "Add a song to the queue (used by the search page).",
        "tags": [
          "queue"
        ]
      }
    },
    "/queue/downloads": {
      "get": {
        "responses": {
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "summary": "Get the status of current and pending downloads.",
        "tags": [
          "queue"
        ]
      }
    },
    "/queue/downloads/errors/{error_id}": {
      "delete": {
        "responses": {
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "summary": "Remove a download error from the list.",
        "tags": [
          "queue"
        ]
      },
      "parameters": [
        {
          "in": "path",
          "name": "error_id",
          "required": true,
          "schema": {
            "type": "string",
            "minLength": 1
          }
        }
      ]
    },
    "/search": {
      "get": {
        "responses": {
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "summary": "YouTube search page.",
        "tags": [
          "search"
        ]
      }
    },
    "/autocomplete": {
      "get": {
        "parameters": [
          {
            "in": "query",
            "name": "q",
            "description": "Search query for autocomplete",
            "schema": {
              "type": "string"
            },
            "required": true
          }
        ],
        "responses": {
          "422": {
            "$ref": "#/components/responses/UNPROCESSABLE_ENTITY"
          },
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "summary": "Search available songs for autocomplete.",
        "tags": [
          "search"
        ]
      }
    },
    "/download": {
      "post": {
        "responses": {
          "422": {
            "$ref": "#/components/responses/UNPROCESSABLE_ENTITY"
          },
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "requestBody": {
          "required": true,
          "content": {
            "application/x-www-form-urlencoded": {
              "schema": {
                "$ref": "#/components/schemas/DownloadForm"
              }
            }
          }
        },
        "summary": "Download a video from YouTube.",
        "tags": [
          "search"
        ]
      }
    },
    "/browse": {
      "get": {
        "responses": {
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "summary": "Browse available songs page.",
        "tags": [
          "files"
        ]
      }
    },
    "/files/delete": {
      "get": {
        "parameters": [
          {
            "in": "query",
            "name": "song",
            "description": "Path to the song file",
            "schema": {
              "type": "string"
            },
            "required": true
          },
          {
            "in": "query",
            "name": "referrer",
            "description": "URL to redirect back to",
            "schema": {
              "type": "string"
            },
            "required": false
          }
        ],
        "responses": {
          "422": {
            "$ref": "#/components/responses/UNPROCESSABLE_ENTITY"
          },
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "summary": "Delete a song file.",
        "tags": [
          "files"
        ]
      }
    },
    "/files/edit": {
      "get": {
        "parameters": [
          {
            "in": "query",
            "name": "song",
            "description": "Path to the song file",
            "schema": {
              "type": "string"
            },
            "required": true
          },
          {
            "in": "query",
            "name": "referrer",
            "description": "URL to redirect back to",
            "schema": {
              "type": "string"
            },
            "required": false
          }
        ],
        "responses": {
          "422": {
            "$ref": "#/components/responses/UNPROCESSABLE_ENTITY"
          },
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "summary": "Show the song rename page.",
        "tags": [
          "files"
        ]
      },
      "post": {
        "responses": {
          "422": {
            "$ref": "#/components/responses/UNPROCESSABLE_ENTITY"
          },
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "requestBody": {
          "required": true,
          "content": {
            "application/x-www-form-urlencoded": {
              "schema": {
                "$ref": "#/components/schemas/EditFileForm"
              }
            }
          }
        },
        "summary": "Process a song rename.",
        "tags": [
          "files"
        ]
      }
    },
    "/change_preferences": {
      "get": {
        "parameters": [
          {
            "in": "query",
            "name": "pref",
            "description": "Name of the preference to change",
            "schema": {
              "type": "string"
            },
            "required": true
          },
          {
            "in": "query",
            "name": "val",
            "description": "New value for the preference",
            "schema": {
              "type": "string"
            },
            "required": true
          }
        ],
        "responses": {
          "422": {
            "$ref": "#/components/responses/UNPROCESSABLE_ENTITY"
          },
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "summary": "Change a user preference setting.",
        "tags": [
          "preferences"
        ]
      }
    },
    "/clear_preferences": {
      "get": {
        "responses": {
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "summary": "Reset all preferences to defaults.",
        "tags": [
          "preferences"
        ]
      }
    },
    "/update_ytdl": {
      "get": {
        "responses": {
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "summary": "Update yt-dlp to the latest version.",
        "tags": [
          "admin"
        ]
      }
    },
    "/refresh": {
      "get": {
        "responses": {
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "summary": "Refresh the available songs list.",
        "tags": [
          "admin"
        ]
      }
    },
    "/quit": {
      "get": {
        "responses": {
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "summary": "Exit the PiKaraoke application.",
        "tags": [
          "admin"
        ]
      }
    },
    "/shutdown": {
      "get": {
        "responses": {
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "summary": "Shut down the host system.",
        "tags": [
          "admin"
        ]
      }
    },
    "/reboot": {
      "get": {
        "responses": {
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "summary": "Reboot the host system.",
        "tags": [
          "admin"
        ]
      }
    },
    "/expand_fs": {
      "get": {
        "responses": {
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "summary": "Expand filesystem on Raspberry Pi.",
        "tags": [
          "admin"
        ]
      }
    },
    "/auth": {
      "post": {
        "responses": {
          "422": {
            "$ref": "#/components/responses/UNPROCESSABLE_ENTITY"
          },
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "requestBody": {
          "required": true,
          "content": {
            "application/x-www-form-urlencoded": {
              "schema": {
                "$ref": "#/components/schemas/AuthForm"
              }
            }
          }
        },
        "summary": "Authenticate as admin.",
        "tags": [
          "admin"
        ]
      }
    },
    "/login": {
      "get": {
        "responses": {
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "summary": "Admin login page.",
        "tags": [
          "admin"
        ]
      }
    },
    "/logout": {
      "get": {
        "responses": {
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "summary": "Log out of admin mode.",
        "tags": [
          "admin"
        ]
      }
    },
    "/skip": {
      "get": {
        "responses": {
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "summary": "Skip the currently playing song.",
        "tags": [
          "controller"
        ]
      }
    },
    "/pause": {
      "get": {
        "responses": {
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "summary": "Toggle pause/resume playback.",
        "tags": [
          "controller"
        ]
      }
    },
    "/transpose/{semitones}": {
      "get": {
        "responses": {
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "summary": "Transpose (pitch shift) the current song.",
        "tags": [
          "controller"
        ]
      },
      "parameters": [
        {
          "in": "path",
          "name": "semitones",
          "required": true,
          "schema": {
            "type": "string",
            "minLength": 1
          }
        }
      ]
    },
    "/restart": {
      "get": {
        "responses": {
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "summary": "Restart the current song from the beginning.",
        "tags": [
          "controller"
        ]
      }
    },
    "/volume/{volume}": {
      "get": {
        "responses": {
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "summary": "Set the playback volume.",
        "tags": [
          "controller"
        ]
      },
      "parameters": [
        {
          "in": "path",
          "name": "volume",
          "required": true,
          "schema": {
            "type": "string",
            "minLength": 1
          }
        }
      ]
    },
    "/vol_up": {
      "get": {
        "responses": {
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "summary": "Increase volume by 10%.",
        "tags": [
          "controller"
        ]
      }
    },
    "/vol_down": {
      "get": {
        "responses": {
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "summary": "Decrease volume by 10%.",
        "tags": [
          "controller"
        ]
      }
    },
    "/bg_music/{file}": {
      "get": {
        "responses": {
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "summary": "Stream a background music file.",
        "tags": [
          "bg_music"
        ]
      },
      "parameters": [
        {
          "in": "path",
          "name": "file",
          "required": true,
          "schema": {
            "type": "string",
            "minLength": 1
          }
        }
      ]
    },
    "/bg_playlist": {
      "get": {
        "responses": {
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "summary": "Get a randomized background music playlist.",
        "tags": [
          "bg_music"
        ]
      }
    },
    "/qrcode": {
      "get": {
        "responses": {
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "summary": "Get QR code image for the web interface URL.",
        "tags": [
          "images"
        ]
      }
    },
    "/logo": {
      "get": {
        "responses": {
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "summary": "Get the PiKaraoke logo image.",
        "tags": [
          "images"
        ]
      }
    },
    "/now_playing": {
      "get": {
        "responses": {
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "summary": "Get current playback status.",
        "tags": [
          "now_playing"
        ]
      }
    },
    "/stream/{id}.m3u8": {
      "get": {
        "responses": {
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "summary": "Serve HLS playlist file.",
        "tags": [
          "stream"
        ]
      },
      "parameters": [
        {
          "in": "path",
          "name": "id",
          "required": true,
          "schema": {
            "type": "string",
            "minLength": 1
          }
        }
      ]
    },
    "/stream/{filename}.m4s": {
      "get": {
        "responses": {
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "summary": "Serve HLS segment file (fragmented MP4).",
        "tags": [
          "stream"
        ]
      },
      "parameters": [
        {
          "in": "path",
          "name": "filename",
          "required": true,
          "schema": {
            "type": "string",
            "minLength": 1
          }
        }
      ]
    },
    "/stream/{filename}_init.mp4": {
      "get": {
        "responses": {
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "summary": "Serve init.mp4 header file for fragmented MP4 streams.",
        "tags": [
          "stream"
        ]
      },
      "parameters": [
        {
          "in": "path",
          "name": "filename",
          "required": true,
          "schema": {
            "type": "string",
            "minLength": 1
          }
        }
      ]
    },
    "/stream/{filename}.ts": {
      "get": {
        "responses": {
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "summary": "Serve HLS segment file (MPEG-TS).",
        "tags": [
          "stream"
        ]
      },
      "parameters": [
        {
          "in": "path",
          "name": "filename",
          "required": true,
          "schema": {
            "type": "string",
            "minLength": 1
          }
        }
      ]
    },
    "/stream/{id}": {
      "get": {
        "responses": {
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "summary": "Route streaming request to HLS or progressive MP4.",
        "tags": [
          "stream"
        ]
      },
      "parameters": [
        {
          "in": "path",
          "name": "id",
          "required": true,
          "schema": {
            "type": "string",
            "minLength": 1
          }
        }
      ]
    },
    "/stream/{id}.mp4": {
      "get": {
        "responses": {
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "summary": "Stream progressive MP4 from HLS-generated segments.",
        "tags": [
          "stream"
        ]
      },
      "parameters": [
        {
          "in": "path",
          "name": "id",
          "required": true,
          "schema": {
            "type": "string",
            "minLength": 1
          }
        }
      ]
    },
    "/stream/full/{id}": {
      "get": {
        "responses": {
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "summary": "Stream video with range headers (Safari compatible).",
        "tags": [
          "stream"
        ]
      },
      "parameters": [
        {
          "in": "path",
          "name": "id",
          "required": true,
          "schema": {
            "type": "string",
            "minLength": 1
          }
        }
      ]
    },
    "/stream/bg_video": {
      "get": {
        "responses": {
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "summary": "Stream the background video file.",
        "tags": [
          "stream"
        ]
      }
    },
    "/subtitle/{id}": {
      "get": {
        "responses": {
          "default": {
            "$ref": "#/components/responses/DEFAULT_ERROR"
          }
        },
        "summary": "Serve subtitle file for the current song.",
        "tags": [
          "stream"
        ]
      },
      "parameters": [
        {
          "in": "path",
          "name": "id",
          "required": true,
          "schema": {
            "type": "string",
            "minLength": 1
          }
        }
      ]
    }
  },
  "info": {
    "title": "PiKaraoke API",
    "version": "1.18.4"
  },
  "tags": [
    {
      "name": "queue",
      "description": ""
    },
    {
      "name": "search",
      "description": ""
    },
    {
      "name": "files",
      "description": ""
    },
    {
      "name": "preferences",
      "description": ""
    },
    {
      "name": "admin",
      "description": ""
    },
    {
      "name": "controller",
      "description": ""
    },
    {
      "name": "bg_music",
      "description": ""
    },
    {
      "name": "images",
      "description": ""
    },
    {
      "name": "now_playing",
      "description": ""
    },
    {
      "name": "stream",
      "description": ""
    }
  ],
  "openapi": "3.0.2",
  "components": {
    "schemas": {
      "Error": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "description": "Error code"
          },
          "status": {
            "type": "string",
            "description": "Error name"
          },
          "message": {
            "type": "string",
            "description": "Error message"
          },
          "errors": {
            "type": "object",
            "description": "Errors",
            "additionalProperties": {}
          }
        },
        "additionalProperties": false
      },
      "PaginationMetadata": {
        "type": "object",
        "properties": {
          "total": {
            "type": "integer"
          },
          "total_pages": {
            "type": "integer"
          },
          "first_page": {
            "type": "integer"
          },
          "last_page": {
            "type": "integer"
          },
          "page": {
            "type": "integer"
          },
          "previous_page": {
            "type": "integer"
          },
          "next_page": {
            "type": "integer"
          }
        },
        "additionalProperties": false
      },
      "ReorderForm": {
        "type": "object",
        "properties": {
          "old_index": {
            "type": "integer",
            "description": "Current index of the item to move"
          },
          "new_index": {
            "type": "integer",
            "description": "Target index to move the item to"
          }
        },
        "required": [
          "new_index",
          "old_index"
        ],
        "additionalProperties": false
      },
      "EnqueueForm": {
        "type": "object",
        "properties": {
          "song_to_add": {
            "type": "string",
            "description": "Path to the song file"
          },
          "song_added_by": {
            "type": "string",
            "default": "",
            "description": "Name of the user adding the song"
          }
        },
        "required": [
          "song_to_add"
        ],
        "additionalProperties": false
      },
      "DownloadForm": {
        "type": "object",
        "properties": {
          "song_url": {
            "type": "string",
            "description": "YouTube URL to download"
          },
          "song_added_by": {
            "type": "string",
            "description": "Name of the user requesting the download"
          },
          "song_title": {
            "type": "string",
            "description": "Display title for the song"
          },
          "queue": {
            "type": "string",
            "description": "Set to 'on' to queue the song after download"
          }
        },
        "required": [
          "song_added_by",
          "song_title",
          "song_url"
        ],
        "additionalProperties": false
      },
      "EditFileForm": {
        "type": "object",
        "properties": {
          "new_file_name": {
            "type": "string",
            "description": "New filename (without extension)"
          },
          "old_file_name": {
            "type": "string",
            "description": "Current full path of the song file"
          },
          "referrer": {
            "type": "string",
            "description": "URL to redirect back to after editing"
          }
        },
        "required": [
          "new_file_name",
          "old_file_name"
        ],
        "additionalProperties": false
      },
      "AuthForm": {
        "type": "object",
        "properties": {
          "admin_password": {
            "type": "string",
            "default": "",
            "description": "Admin password"
          },
          "next": {
            "type": "string",
            "default": "/",
            "description": "URL to redirect to after login"
          }
        },
        "additionalProperties": false
      }
    },
    "responses": {
      "DEFAULT_ERROR": {
        "description": "Default error response",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/Error"
            }
          }
        }
      },
      "UNPROCESSABLE_ENTITY": {
        "description": "Unprocessable Entity",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/Error"
            }
          }
        }
      }
    }
  }
}