{% extends 'base.html' %} {% block scripts %}
<script>
  $(function () {
    $("#quit-link").click(function (e) {
      e.preventDefault();
      // {# MSG: Confirmation text whe the user selects quit. #}
      if (window.confirm("{{ _('Are you sure you want to quit?') }}")) {
        location.href = this.href;
      }
    });

    $("#shutdown-link").click(function (e) {
      e.preventDefault();
      // {# MSG: Confirmation text whe the user starts to turn off the machine running Pikaraoke. #}
      if (window.confirm("{{ _('Are you sure you want to shut down?') }}")) {
        location.href = this.href;
      }
    });

    $("#restart-link").click(function (e) {
      e.preventDefault();
      // {# MSG: Confirmation text whe the user starts to reboot the machine running Pikaraoke. #}
      if (window.confirm("{{ _('Are you sure you want to reboot?') }}")) {
        location.href = this.href;
      }
    });

    $("#update-ytdl-link").click(function (e) {
      e.preventDefault();
      if (
        window.confirm(
          // {# MSG: Confirmation text whe the user asks to update the Youtube-dl tool. #}
          "{{ _('Are you sure you want to update Youtube-dl right now? Current and pending downloads may fail.') }}"
        )
      ) {
        location.href = this.href;
      }
    });

    $("#expand-link").click(function (e) {
      e.preventDefault();
      // {# MSG: Confirmation text when the user wants to expand the filesystem to take the entire SD card. #}
      if (window.confirm("{{ _('Are you sure you want to expand the filesystem? This will reboot your raspberry pi.')}}")) {
        location.href = this.href;
      }
    });

    $("#audio-devices").change(function (e) {
      e.preventDefault();
      // {# MSG: Confirmation text when the user wants to change the audio device. #}
      if (window.confirm("{{ _('Are you sure you want to change the audio device?')}}")) {
        changeDevice($(this).val())
      }
    });

    function changeDevice(deviceValue){
      url = "{{ url_for('change_audio_output') }}" + "?device=" + deviceValue
      window.location.href = url;
    }

    $(".device-volume-button").click(function (e) {
      e.preventDefault();

      if ($(this).prop("disabled")) return;

      let volume = parseInt($("#volume-value").text(), 10)
      let upOrDown = $(this).attr("volume")
      let url = $(this).data("url");

      volume = (upOrDown == "up") ? volume + 10 : volume - 10

      console.log(volume)
      console.log(typeof volume)

      $.get( url, function( response ) {
        if (response.msg && response.status) {
          showNotification(response.msg, response.status);
          if (response.status == "is-success"){
            console.log(volume)
            console.log(volume === 150)
            $("#volume-value").text(volume + "%");
            $("#device-volume-up").prop("disabled", volume === 150);
            $("#device-volume-down").prop("disabled", volume === 0);
          }
        }
      });
    });

    $("#bt-container").on("click", ".pair-device", function(){
      // {# MSG: Notification text when the system is pairing a bluetooth device. #}
      showNotification("{{ _('Pairing bluetooth device...')}}", "is-info", timeout=15000);
    })

    $("#bt-container").on("click", ".remove-device", function(){
      // {# MSG: Notification text when the system is removing a bluetooth device. #}
      showNotification("{{ _('Removing bluetooth device...')}}", "is-info", timeout=15000);
    })

  });

</script>
{% endblock %}

{% block header %}
  <h1>{% block title %}
    {# MSG: Title of the information page. #}
    {% trans %}Information{% endtrans %}
  {% endblock %}</h1>
{% endblock %}

{% block content %}
<hr/>

<div class="has-text-centered">
  <p>
    {# MSG: Label which appears before a url which links to the current page. #}
    {%- trans -%}
      URL of {{site_title}}:
    {%- endtrans -%}
  </p>
  <p class="is-size-4 has-text-warning has-text-centered">{{ url }}</p>
  {# MSG: Label before a QR code which brings a frind (pal) to the main page if scanned, so they can also add songs. QR code follows this text. #}
  <p>{% trans %}Handy URL QR code to share with a pal:{% endtrans %}</p>
  <img id="qr-img" width="300px" src="{{ url_for('qrcode') }}" style="image-rendering: pixelated" />

  </div>

<hr />

{# MSG: Header of the information section about the computer running Pikaraoke. #}
<h1>{% trans %}System Info{% endtrans %}</h1>
<ul>
  {# MSG: The hardware platform  #}
  <li><u>{% trans %}Platform:{% endtrans %}</u> {{ platform }}</li>
  {# MSG: The os version  #}
  <li><u>{% trans %}OS Version:{% endtrans %}</u> {{ os_version }}</li>
  {# MSG: The version of the program "Youtube-dl". #}
  <li><u>{% trans %}Youtube-dl (yt-dlp) version:{% endtrans %}</u> {{ youtubedl_version }}</li>
  {# MSG: The version of the program "ffmpeg". #}
  <li><u>{% trans %}FFmpeg version:{% endtrans %}</u> {{ ffmpeg_version }} {% if not is_transpose_enabled %} (missing lib-rubberband, pitch shift is not supported) {% endif %}</li>
  {# MSG: The version of Pikaraoke running right now. #}
  <li><u>{% trans %}Pikaraoke version:{% endtrans %}</u> {{ pikaraoke_version }}</li>
</ul>
<h1>{% trans %}System stats{% endtrans %}</h1>
<ul>
  {# MSG: The CPU usage of the computer running Pikaraoke. #}
  <li>{% trans %}CPU: {{ cpu }}{% endtrans %}</li>
  {# MSG: The disk usage of the computer running Pikaraoke. Used by downloaded songs. #}
  <li>{% trans %}Disk Usage: {{ disk }}{% endtrans %}</li>
  {# MSG: The memory (RAM) usage of the computer running Pikaraoke. #}
  <li>{% trans %}Memory: {{ memory }}{% endtrans %}</li>
</ul>

<hr />

{% if admin %}
{# MSG: Title of the updates section. #}
<h1>{% trans %}Updates{% endtrans %}</h1>
{# MSG: Label before a link which forces Pikaraoke to rescan and pick up any new songs. #}
<p>{% trans %}Refresh the song list:{% endtrans %}</p>
<ul>
  <li>
    <a href="/refresh"
    {# MSG: Text on the link which forces Pikaraoke to rescan and pick up any new songs. #}
      >{% trans %}Rescan song directory{% endtrans %}</a
    >
  </li>
</ul>
{# MSG: Help text explaining the Rescan song directory link. #}
<p class="help">{% trans -%}
  You should only need to do this if you manually copied files to the download directory while pikaraoke was running.
  {%- endtrans %}</p>

{# MSG: Text explaining why you might want to update youtube-dl. #}
<p>{% trans %}If downloads or searches stopped working, updating youtube-dl will probably fix it.
   The current installed version is: "{{ youtubedl_version }}"{% endtrans %}</p>
<ul>
  <li>
    <a id="update-ytdl-link" href="{{ url_for('update_ytdl') }}"
    {# MSG: Text for the link which will try and update youtube-dl on the machine running Pikaraoke. #}
      >{% trans %}Update youtube-dl{% endtrans %}</a
    >
  </li>
</ul>
<p class="help">
  {# MSG: Help text which explains why updating youtube-dl can fail.  The log is a file on the machine running Pikaraoke. #}
  {% trans -%}
    This update link above may fail if you don't have proper file permissions.
    Check the pikaraoke log for errors.
  {%- endtrans %}
</p>

{# MSG: Title of the section on shutting down / turning off the machine running Pikaraoke. #}
<h1>{% trans %}Shutdown{% endtrans %}</h1>
<p>
  {# MSG: Explainitory text which explains why to use the shutdown link. #}
  {% trans -%}
    Don't just pull the plug! Always shut down your server properly to avoid data corruption.
  {%- endtrans %}
</p>
<ul>
  {# MSG: Text for button which turns off Pikaraoke for everyone using it at your house. #}
  <li><a id="quit-link" href="{{ url_for('quit') }}">{% trans %}Quit Pikaraoke{% endtrans %}</a></li>
  {% if is_pi or is_linux %}
    {# MSG: Text for button which reboots the machine running Pikaraoke. #}
    <li><a id="restart-link" href="{{ url_for('reboot') }}">{% trans %}Reboot System{% endtrans %}</a></li>
    <li>
      {# MSG: Text for button which turn soff the machine running Pikaraoke. #}
      <a id="shutdown-link" href="{{ url_for('shutdown') }}">{% trans %}Shutdown System{% endtrans %}</a>
    </li>
  {% endif %}
</ul>

{% if is_pi %}
  {# MSG: Title for section containing a few other options on the Info page. #}
  <h1>{% trans %}Other{% endtrans %}</h1>
  <a id="expand-link" href="{{ url_for('expand_fs') }}">
    {# MSG: Text for button#}
    {% trans %}Expand Raspberry Pi filesystem{% endtrans %}
  </a></li>
  {# MSG: Explainitory text which explains why you might want to expand the filesystem. #}
  <p class="help">{% trans -%}
    If you just installed the pre-built pikaraoke pi image and your SD card is larger than 4GB,
    you may want to expand the filesystem to utilize the remaining space. You only need to do this once.
    This will reboot the system.
  {%- endtrans %}</p>

  {% if have_pipewire %}
    <hr/>
    {# MSG: Title for section about output audio devices #}
    <h1>{% trans %}Output Audio Device{% endtrans %}</h1>
    {# MSG: Subtitle for section where the user can change the default audio output #}
    <h3>{% trans %}Main Sound Output{% endtrans %}</h3>
    {# MSG: Explainitory text which explains about the default audio output. #}
    <p class="help">{% trans -%}
      If you want to change the default audio output, you can do so here. It uses Pipewire with Wireplumber so it's necessary to have them installed in your system.
    {%- endtrans %}</p>
    <div id="sound-devices" class="select is-loading">
        <select id="audio-devices" name="audio-devices">
        </select>
    </div>

    {# MSG: Subtitle for section where the user can change the audio output volume #}
    <h3>{% trans %}Output Audio Device volume{% endtrans %}</h3>
    {# MSG: information when the system is loading #}
    <p class="loading">{% trans %}Loading...{% endtrans %}</p>
    <div id="volume-buttons"class="buttons is-hidden">
      {# MSG: Button for decreasing device volume #}
      <button data-url="{{ url_for('change_device_volume', volume='down') }}" id="device-volume-down" class="device-volume-button button" volume="down" style="margin: 0" title="{% trans %}Decrease volume 10%{% endtrans %}">
        <span class="icon icon-volume-down"></span>
      </button>
      <span id="volume-value" class="tag is-medium" style="margin: 0 0.5rem;"></span>
      {# MSG: Button for increasing device volume #}
      <button data-url="{{ url_for('change_device_volume', volume='up') }}" id="device-volume-up" class="device-volume-button button" volume="up" style="margin: 0" title="{% trans %}Increase volume 10%{% endtrans %}">
        <span class="icon icon-volume-up"></span>
      </button>
    </div>

    {# MSG: Subtitle for section where the user can scan and pair bluetooth devices #}
    <h1>{% trans %}Bluetooth Devices{% endtrans %}</h1>
    {# MSG: information when the system is loading #}
    <p class="loading">{% trans %}Loading...{% endtrans %}</p>
    <div id="bt-container" class="is-hidden">
      <div id="known-bt-devices-container">
        {# MSG: Subtitle for the Bluetooth section where the user can find known bluetooth devices #}
        <p>{% trans %}Known devices:{% endtrans %}</p>
        <ul id="known-bt-devices" class="bt-devices">
        </ul>
      </div>
      <div id="new-bt-devices-container">
      {# MSG: Subtitle for the Bluetooth section where the user can find New bluetooth devices #}
      <p>{% trans %}Found devices:{% endtrans %}</p>
        <ul id="new-bt-devices" class="bt-devices">
        </ul>
      </div>
    </div>

    <script>
      $(document).ready(function () {
        $.getJSON("{{ url_for('get_audio_devices') }}", function (data) {
          // Hide "loading..."
          $(".loading").hide();
          $("#sound-devices").removeClass("is-loading")

          if ("audio_devices" in data){
            for (audio_device of data["audio_devices"]){
              if (audio_device["default"]){
                $("#audio-devices").append($("<option selected>").attr("value", audio_device["number"]).text("*" + audio_device["name"]))
                $("#volume-value").text(audio_device["volume"] + "%")
                $("#volume-buttons").removeClass("is-hidden")
              } else {
                $("#audio-devices").append($("<option>").attr("value", audio_device["number"]).text(audio_device["name"]))
              }
            }
          } else {
            // {# MSG: Text information for when no audio devices are found #}
            $("#audio-devices").append($("<option>").attr("value", "").text("No audio devices found"))
          }

          if ("bluetooth" in data){
            if (data["bluetooth"]["known"].length != 0){
              for (bt_device of data["bluetooth"]["known"]){

                line = `<li class="known-bt-device">`

                if ("audio_device" in bt_device){
                  if (!bt_device["default"]){
                    // {# MSG: Link to make a known bluetooth device the default output audio device #}
                    line += `<a href="{{ url_for('change_audio_output') }}?device=${bt_device.number}" class="make-bt-default-device" >${bt_device.name}</a>
                      <span> | </span>
                      <a href="{{ url_for('change_audio_output') }}?device=${bt_device.number}" class="make-bt-default-device" >{% trans %}Make default output{% endtrans %}</a>`
                  }else{
                    line += `${bt_device.name}`
                  }
                } else {
                  line += `<a href="{{ url_for('pair_bt_device') }}?mac=${bt_device.mac}&name=${bt_device.name}" class="pair-device" >${bt_device.name}</a>`
                }

                // {# MSG: Link to remove a known bluetooth device #}
                line += `<span> | </span>
                <a href="{{ url_for('remove_bt_device') }}?mac=${bt_device.mac}&name=${bt_device.name}" class="remove-bt-device" >{% trans %}Remove{% endtrans %}</a>
                </li>`

                $("#known-bt-devices").append(line)
              }
            } else {
              $("#known-bt-devices-container").addClass("is-hidden")
            }

            if (data["bluetooth"]["new"].length != 0){
              for (bt_device of data["bluetooth"]["new"]){
                $("#new-bt-devices").append(
                  `<li class="new-bt-device">
                    <a href="{{ url_for('pair_bt_device') }}?mac=${bt_device.mac}&name=${bt_device.name}" class="pair-device" >${bt_device.name}</a>
                  </li>`
                )
              }
            } else {
              // {# MSG: Message to the user when no bluetooth devices are found #}
              $("#new-bt-devices-container p").text("No devices found!")
            }


            $("#bt-container").removeClass("is-hidden")
          }
        })
      })
    </script>
  {% endif %}
{% endif %}

<hr/>
{% if admin_enabled %}
  {# MSG: Link which will log out the user from admin mode. #}
  <p>{% trans logout_url=url_for('logout') -%}
    Disable admin mode: <a href="{{ logout_url }}">Log out</a>
  {%- endtrans %}</p>
{% endif %}
{% else %} {# from if admin #}
  {# MSG: Link which will let the user log into admin mode. #}
  <p>{% trans login_url=url_for('login') %}
    Enable admin mode: <a href="{{ login_url }}">Log in</a>
  {% endtrans %}</p>
{% endif %}

{% endblock %}
